# Glean (拾阅) - 前端详尽设计规范 (PWA 版)

## 1. 核心架构说明

- **前后端协议**：后端 API 必须返回 **纯文本 (Plain Text)** 格式的章节内容。前端动态转换为 `p` 标签进行渲染。
- **技术栈**：Vue 3 (Script Setup), Tailwind CSS, Pinia (状态管理), `vite-plugin-pwa` (PWA 支持)。

## 2. 页面与路由设计

### A. 书架页 (Bookshelf) - `/`

- **展示形式**：简明的列表 (List View)。
- **条目内容**：书名、上次阅读章节、阅读进度百分比（右侧）、最后一次阅读时间。
- **交互**：点击直接进入阅读器对应的历史位置；长按或右键调出“删除/标星”菜单。

### B. 发现与文件库 (Discovery & Library) - `/discovery`

- **物理路径浏览**：支持层级目录跳转。后端返回当前目录下的 `folders` 和 `files`。
- **随机功能**：顶部提供一个固定入口“随便看看 (Random)”。
- **文件管理**：每个文件条目旁有“标星”和“删除”图标。

### C. 阅读器 (Reader) - `/reader/:id`

- **核心逻辑**：
  - **纯文本渲染**：从后端获取 `content`，在前端进行排版。
  - **无缝滚动**：支持点击翻页与平滑滚动。
  - **预取逻辑**：当前章节读完 80% 时，静默请求下一章缓存。

另外需要选择一个美观的中文非衬线字体用于展示内容。

## 3. 阅读器 3x3 九宫格交互设计

在阅读界面上层覆盖一个 `fixed` 定位的透明网格层（Z-index 较高）：

| 左 | 中 | 右 |
| :--- | :--- | :--- |
| (0,0) 返回上一页 | (1,0) 返回上一页 | (2,0) 下一页 |
| (0,1) 下一页 | (1,1) 弹出设置菜单 | (2,1) 下一页 |
| (0,2) 下一页 | (1,2) 下一页 | (2,2) 下一页 |

- **逻辑细节**：
  - **(0,0)**: `router.back()`。
  - **(1,1)**: 切换 `showSettingsPanel` 状态。
  - **其他 7 个区域**: 触发 `nextPage` 逻辑（向下滚动一个屏幕高度或加载下一章）。

## 4. PWA 标准与离线化支持

项目必须符合 PWA 规范，确保在移动端可添加至桌面并全屏运行。

- **依赖库**：`vite-plugin-pwa`。
- **Service Worker 策略**：
  - **CacheFirst**：对于静态资源（字体、图标、UI 框架代码）。
  - **NetworkFirst**：对于书籍列表和目录。
  - **离线预存**：当用户点开某本书时，SW 自动缓存当前章节及其后两章的纯文本 API 响应。
- **清单文件 (manifest.json)**：
  - `display: fullscreen` (去除浏览器地址栏)。
  - `orientation: portrait-primary` (锁定竖屏，可选)。

## 5. 前端细节控制 (AI 实现指引)

### 设置面板 (SettingsPanel) 内容

- **亮度调节**（系统级或叠加半透明黑层）。
- **字号调节**（12px - 32px）。
- **背景主题**：明亮、护眼、纸张、深色。
- **进度跳转**：一个 `input range` 滑块，对应章节的百分比。

## 6. 后端 API 配合建议

为了配合前端，后端 API 应设计为：

- `GET /api/files?path=/relative/path`：返回该路径下的文件和文件夹列表。
- `GET /api/chapters/{book_id}/{chapter_index}`：返回：

  ```json
  {
    "title": "第十章 XXX",
    "content": "纯文本内容...",
    "next_index": 11,
    "prev_index": 9
  }
  ```

## 7. 交互动画建议

- 页面切换使用 `Vue Transition` 的 `fade` 效果。
- 设置面板从底部向上滑出 (`translate-y`)。
- 侧边文件目录从左侧滑出。
